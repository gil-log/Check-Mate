<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="groupMapper">

	<insert id="GroupCreate"><!-- parameterType="com.checkmate.vo.GroupVO"  -->
	    INSERT INTO C_Group(   G_NO 
	   					       , U_ID
	   					       , G_NAME
	   					       , G_FLAG
	   					       )
	                  VALUES(    G_NO_SEQ.NEXTVAL
	                 		   , #{u_id}
	                 		   , #{g_name}
	                 		   , 1
	                 		   )
    </insert>
		
	<select id="GroupList" resultType="com.checkmate.vo.GroupVO" parameterType="com.checkmate.vo.GroupVO">
      SELECT G_NO, U_ID, G_NAME, G_FLAG
      FROM C_GROUP
      WHERE G_NO = #{g_no}
      ORDER BY G_NO DESC
	</select>
	
	<select id="GroupListCount" resultType="int" parameterType="com.checkmate.vo.GroupVO">
      SELECT COUNT(G_NO)
      FROM C_GROUP
	</select>
	
	<select id="findMaster" resultType="com.checkmate.vo.GroupVO" parameterType="com.checkmate.vo.GroupVO">
		SELECT G_NO, U_ID, G_FLAG, G_NAME
		FROM C_GROUP
		WHERE G_NO = #{g_no} AND G_FLAG = 1
	</select>

	<update id="userPoint" parameterType="com.checkmate.vo.GroupPointVO">
		UPDATE C_GROUP SET
		U_POINT = #{u_point}
		WHERE G_NO = #{g_no} AND U_ID = #{u_id} AND G_FLAG = #{g_flag}
	</update>













	<select id="attendList" resultType="com.checkmate.vo.AttendVO" parameterType="com.checkmate.vo.AttendVO">
		SELECT A_DATE, G_NO, U_ID, A_FLAG
		FROM   C_ATTEND
		WHERE  U_id = #{u_id}
		AND    G_NO = #{g_no}
	</select>
	
	<!-- 관리자가 아닌 인원들이 출석체크를 눌렀을 경우 동작 -->
	<insert id="attendInsert" parameterType="com.checkmate.vo.AttendVO">
		INSERT INTO C_ATTEND (A_DATE, U_ID, G_NO, A_FLAG)
		VALUES(SYSDATE + #{a_date}/24/60, #{u_id}, #{g_no}, 0)	
	</insert>
	
	<!-- calendar 용 attend flag 별로 list 뽑기 -->
	<select id="attendListCalendar" resultType="com.checkmate.vo.AttendVO" parameterType="com.checkmate.vo.AttendVO">
		SELECT A_DATE, G_NO, U_ID, A_FLAG
		FROM   C_ATTEND
		WHERE  U_id = #{u_id}
		AND    G_NO = #{g_no}
		AND    A_FLAG = #{a_flag}
	</select>
	
	<!-- calendar용 해당 그룹에 입력한 id에 해당하는 attend가 몇개인지를 받아온다. -->
	<select id="attendGnoUidCount" resultType="com.checkmate.vo.AttendVO" parameterType="com.checkmate.vo.GroupVO">
		SELECT COUNT(*)
		FROM(
		SELECT A_DATE, G_NO, U_ID, A_FLAG
		FROM   C_ATTEND
		WHERE  U_id = #{u_id}
		AND    G_NO = #{g_no})
	</select>
</mapper>